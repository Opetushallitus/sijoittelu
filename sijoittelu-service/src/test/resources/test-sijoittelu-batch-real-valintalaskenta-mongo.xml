<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:mockito="http://www.mockito.org/spring/mockito"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:jaxrs-client="http://cxf.apache.org/jaxrs-client"
       xmlns:http="http://cxf.apache.org/transports/http/configuration"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd

                http://cxf.apache.org/jaxrs-client http://cxf.apache.org/schemas/jaxrs-client.xsd
                        http://www.mockito.org/spring/mockito http://www.mockito.org/spring/mockito.xsd
                        http://cxf.apache.org/transports/http/configuration         http://cxf.apache.org/schemas/configuration/http-conf.xsd
                        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

  <import resource="classpath:META-INF/cxf/cxf.xml" />
  <import resource="classpath:META-INF/cxf/cxf-servlet.xml" />

  <mockito:mock id="virkailijaValintaTulosServiceResource"
                class="fi.vm.sade.sijoittelu.laskenta.external.resource.VirkailijaValintaTulosServiceResource"/>
  <mockito:mock id="valintarekisteriService"
                  class="fi.vm.sade.sijoittelu.laskenta.service.business.ValintarekisteriService"/>
  <mockito:mock id="authorizer" class="fi.vm.sade.authentication.business.service.Authorizer"/>
  <mockito:mock id="valintaperusteetResourceV2"
                  class="fi.vm.sade.service.valintaperusteet.resource.ValintaperusteetResourceV2"/>

  <http:conduit name="*.http-conduit">
    <http:client ReceiveTimeout="3000000"/>
  </http:conduit>

  <bean id="pipedHostVirkailija" class="java.lang.String">
    <constructor-arg type="java.lang.String"
                     value="#{systemProperties['PIPED_HOST_VIRKAILIJA'] ?: 'Please set PIPED_HOST_VIRKAILIJA system property!' }"/>
  </bean>

  <jaxrs-client:client id="ValintaperusteetKoostepalveluRestClient"
                       address="#{pipedHostVirkailija + '/valintaperusteet-service/resources'}"
                       serviceClass="fi.vm.sade.service.valintaperusteet.resource.ValintalaskentakoostepalveluResource"
                       inheritHeaders="true">
    <jaxrs-client:providers>
      <bean class="com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider"/>
      <bean class="fi.vm.sade.sijoittelu.tulos.resource.ObjectMapperProvider"/>
    </jaxrs-client:providers>
  </jaxrs-client:client>

  <jaxrs-client:client id="ParametriServiceRestClient"
                       address="#{pipedHostVirkailija + '/ohjausparametrit-service/api'}"
                       serviceClass="fi.vm.sade.sijoittelu.laskenta.external.resource.OhjausparametriResource"
                       inheritHeaders="true">
    <jaxrs-client:providers>
      <bean class="com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider"/>
      <bean class="fi.vm.sade.sijoittelu.tulos.resource.ObjectMapperProvider"/>
    </jaxrs-client:providers>
  </jaxrs-client:client>
  <jaxrs-client:client id="TarjontaHakuResourceRestClient"
                       address="#{pipedHostVirkailija + '/tarjonta-service/rest'}"
                       serviceClass="fi.vm.sade.sijoittelu.laskenta.external.resource.HakuV1Resource"
                       inheritHeaders="true">
    <jaxrs-client:providers>
      <bean class="com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider"/>
      <bean class="fi.vm.sade.sijoittelu.tulos.resource.ObjectMapperProvider"/>
    </jaxrs-client:providers>
  </jaxrs-client:client>
  <jaxrs-client:client id="TarjontaHakukohdeResourceRestClient"
                       address="#{pipedHostVirkailija + '/tarjonta-service/rest'}"
                       serviceClass="fi.vm.sade.sijoittelu.laskenta.external.resource.HakukohdeV1Resource"
                       inheritHeaders="true">
    <jaxrs-client:providers>
      <bean class="com.fasterxml.jackson.jaxrs.json.JacksonJsonProvider"/>
      <bean class="fi.vm.sade.sijoittelu.tulos.resource.ObjectMapperProvider"/>
    </jaxrs-client:providers>
  </jaxrs-client:client>

  <bean id="mongoUri2" class="com.mongodb.MongoClientURI">
    <constructor-arg type="java.lang.String"
                     value="#{systemProperties['QA_VIRKAILIJAMONGO_URL'] ?: 'Please set QA_VIRKAILIJAMONGO_URL system property!' }" />
  </bean>

  <bean id="mongo2" class="com.mongodb.MongoClient">
    <constructor-arg type="com.mongodb.MongoClientURI" ref="mongoUri2"/>
  </bean>
  <bean id="morphia2" class="org.mongodb.morphia.Morphia"/>
  <bean id="datastore2" factory-bean="morphia2" factory-method="createDatastore">
    <constructor-arg type="com.mongodb.MongoClient" ref="mongo2"/>
    <constructor-arg type="java.lang.String" value="valintalaskentadb"/>
  </bean>

  <context:annotation-config/>
  <context:component-scan base-package="fi.vm.sade.sijoittelu.tulos"/>
  <context:component-scan base-package="fi.vm.sade.sijoittelu.laskenta"/>
  <context:component-scan base-package="fi.vm.sade.sijoittelu.batch"/>

  <context:component-scan base-package="fi.vm.sade.valintalaskenta.tulos.dao"/>
  <context:component-scan base-package="fi.vm.sade.valintalaskenta.tulos.service.impl"/>
  <context:component-scan base-package="fi.vm.sade.valintalaskenta.tulos.resource.impl"/>
  <context:component-scan base-package="fi.vm.sade.valintalaskenta.tulos.service.impl.converters"/>

  <bean id="modelMapper" class="fi.vm.sade.valintalaskenta.tulos.mapping.ValintalaskentaModelMapper"/>

  <bean id="sijoitteluModelMapper" class="fi.vm.sade.sijoittelu.laskenta.mapping.SijoitteluModelMapper"/>

  <bean id="fakeSijoitteluBusinessService" class="fi.vm.sade.sijoittelu.SijoitteluIntegrationTestToBeRunManually$LightWeightSijoitteluBusinessServiceForTesting"/>

  <bean id="valintatietoService" class="fi.vm.sade.valintalaskenta.tulos.service.impl.rest.ValintatietoServiceImpl"/>

  <bean id="sijoitteluResource" class="fi.vm.sade.sijoittelu.laskenta.resource.SijoitteluResource">
    <constructor-arg index="0" ref="fakeSijoitteluBusinessService"/>
    <constructor-arg index="1" ref="valintatietoService"/>
    <constructor-arg index="2" ref="ValintaperusteetKoostepalveluRestClient"/>
  </bean>

</beans>
